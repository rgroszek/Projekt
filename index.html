<!doctype html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Wielopokojowy czat</title>
     <script src="/socket.io/socket.io.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
      <script>

  var socket = io.connect('http://localhost:8080');

   
  var emoticons = {

    //smile: '<img src="emotikonki/smile.gif" />',
    smile: '<img src="emotikonki/smiley.gif" alt="Smiley face" />',
    sad: '<img src="emotikonki/sad.gif" />',
    wink: '<img src="emotikonki/wink.gif" />'
  };
  var patterns = {
    smile: /:-\)/gm,
    sad: /:-\(/gm,
    wink: /;-\)/gm
  };



  function oknoPrompt() {
    var nick = prompt('Podaj swój nick:', 'Anonim');
        if (nick != null) {
            //alert('Witaj ' + nick);
        } else {
            location.reload();
            //alert('Anulowałeś akcję');
        }
        return nick;
    }

  socket.on('connect', function(){
    socket.emit('adduser', 
      //prompt("Podaj swoje imię.", "Anonim")
      oknoPrompt()
      );
  });

  socket.on('updatechat', function (username, data) {
    $('#rozmowa').append('<b>'+username + ':</b> ' + data + '<br>');

     //wstawienie emotikonek
    /*
    $("#rozmowa b").each(function(){
      var #rozmowa = $(this);
      var html = #rozmowa.html();


      $(this).html(html.replace(patterns.smile, emoticons.smile).replace(patterns.sad, emoticons.sad).replace(patterns.wink, emoticons.wink));
      */
  });

  socket.on('updateusers', function(data) {
    $('#users').empty();
    $.each(data, function(key, value) {
      $('#users').append('<div>' + key + '</div>');
    });
  });


  socket.on('updaterooms', function(rooms, current_room) {
    $('#rooms').empty();
    $.each(rooms, function(key, value) {
      if(value == current_room){
        $('#rooms').append('<div>' + value + '</div>');
      }
      else {
        $('#rooms').append('<div><a href="#" onclick="switchRoom(\''+value+'\')">' + value + '</a></div>' + '');
        $('#rooms').append('<div><input type="button" id=\''+value+'\' + value="usuń" /></div>');
      }
    });
  });

  function switchRoom(room){
    socket.emit('switchRoom', room);
  }

  $(function(){
    
    $('#datasend').click( function() {
      var message = $('#data').val();
      $('#data').val('');
      socket.emit('sendchat', message);
    });


    $('#dodaj_pokoj').click(function(){
      var wartosc = $('input[id=pokoj]').val();
      socket.emit('addroom', wartosc);
      return wartosc;
    });

    $('#wyjdz').click( function() {
      socket.disconnect();
      location.reload();
      //var message = $('#data').val();
      //$('#data').val('');
      // tell server to execute 'sendchat' and send along one parameter
      //socket.emit('sendchat', message);
    });

    $('#data').keypress(function(e) {
      if(e.which == 13) {
        $(this).blur();
        $('#datasend').focus().click();
      }
    });
  });
</script>
  </head>
  <body>
   
    <div style="float:left;width:100px;border-right:1px solid black;height:300px;padding:10px;overflow:scroll-y;">
      <b>Zalogowani użytkownicy:</b>
      <div id="users"></div>
    </div>
    <div style="float:left;width:100px;border-right:1px solid black;height:300px;padding:10px;overflow:scroll-y;">
      <b>Pokoje:</b>
      <input id="pokoj" style="width:70px;" />
      <input type="button" id="dodaj_pokoj" value="Dodaj" />
      <div id="rooms"></div>
    </div>
    <div style="float:left;width:300px;height:250px;overflow:scroll-y;padding:10px;">
      <div id="rozmowa"></div>
      <img src="emotikonki/smile.png" height="42" width="42"/>
      <input id="data" style="width:200px;" />
      <input type="button" id="datasend" value="send" />
      <input type="button" id="wyjdz" value="wyjdz" />
    </div>
  </body>
</html>


